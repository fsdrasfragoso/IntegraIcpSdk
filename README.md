 # IntegraICP ![IntegraICP Logo](https://developers.integraicp.com.br/images/integraicp-logo.png) **Revisado em 2024-05-22** ## Sobre a IntegraICP A **IntegraICP** é uma plataforma que reúne os principais Prestadores de Serviços de Confiança do Brasil, oferecendo **APIs simples** para: - Criação de Assinaturas Digitais. - Identificação de Pessoas e Entidades utilizando Certificados Digitais em Nuvem. Para utilizar os serviços, as aplicações (web ou móveis) precisam de acesso a um **Channel** (equivalente a uma API-Key), que pode ser solicitado por: - [Portal Valid](https://valid-sa.atlassian.net/servicedesk/customer/portal/4/group/115/create/51) - E-mail: [produtos.certificadora@valid.com](mailto:produtos.certificadora@valid.com) --- ## Assinatura Eletrônica Qualificada ### Passos para Assinatura Digital: 1. **Invocação da API de Autenticação:** Gera uma lista de Clearances. 2. **Escolha de Clearance:** Seleção do provedor para identificação do usuário. 3. **Processo de Autenticação:** IntegraICP retorna um `CredentialId` à aplicação via callback URI. 4. **Preparação da Assinatura Eletrônica:** Cálculo do SHA256 dos conteúdos a serem assinados. 5. **Execução do Serviço de Assinatura Eletrônica:** Realização da assinatura utilizando `CredentialId` e os hashes. 6. **Consulta de Credenciais:** Acesso às informações do Certificado Digital usado. --- ## Diagrama de Sequência ![Diagrama de Sequência](https://developers.integraicp.com.br/images/sequence-diagram.png) --- ## Referência de APIs ### **Authentications** **Endpoint:** `GET /c/{channelId}/icp/v3/authentications` **Descrição:** Fornece uma lista de provedores de serviços de confiança (Clearances) para autenticação e assinaturas. #### Parâmetros da Query String | Parâmetro | Descrição | Opcional | |---------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------| | `subject_key` | Identificação única do proponente (ex.: CPF, somente números). | Sim | | `subject_type` | Tipo de proponente (atualmente restrito a `CPF`). | Sim | | `secret_data` | Código de segurança gerado pela aplicação para criptografar/anonimizar os dados (conforme [RFC 7636](https://datatracker.ietf.org/doc/html/rfc7636)). | Não | | `secret_type` | Tipo de segurança (atualmente restrito a `code_challenge`, aceitando somente S256). | Sim | | `callback_uri` | URL para onde os resultados da autenticação serão enviados. | Não | | `autostart` | Inicia o processo automaticamente (`true` ou `false`). | Sim | | `credential_lifetime` | Tempo de expiração da credencial (em segundos, máx.: 168h). | Sim | | `clearance_lifetime` | Tempo de ativação da liberação (em segundos, máx.: 24h). | Sim | --- ### **Credentials** **Endpoint:** `GET /c/{channelId}/icp/v3/credentials/{credentialId}` **Descrição:** Obtém detalhes da credencial autenticada, como informações do certificado digital. --- ### **Signatures** **Endpoint:** `POST /c/{channelId}/icp/v3/signatures` **Descrição:** Permite a assinatura eletrônica de múltiplos conteúdos de forma segura. #### Exemplo de Requisição ```json { "credentialId": "01HQNT0RBF8VFPQ6MAVAG1BWPG", "secretType": "code_verifier", "secretData": "4yrDHoTpVMTvMPemeZlIzfCPMOhd5QXiNxVcmycmWqU", "requests": [ { "contentId": "doc_001", "contentDigest": "4yrDHoTpVMTvMPemeZlIzfCPMOhd5QXiNxVcmycmWqU=", "contentDescription": "Documento de teste", "signaturePolicy": "RAW" } ] } ``` --- ## Implementação da RFC 7636 A **RFC 7636 (Proof Key for Code Exchange by OAuth Public Clients)** é usada para mitigar ataques de interceptação de códigos de autorização em comunicações OAuth. Consulte [RFC 7636](https://datatracker.ietf.org/doc/html/rfc7636) para mais detalhes. #### Exemplo de Geração de `secret_data` em Node.js: ```javascript const crypto = require('crypto'); const base64url = require('base64url'); function generateSecretData() { const secret = crypto.randomBytes(32).toString('base64url'); const challenge = base64url(crypto.createHash('sha256').update(secret).digest()); return { secret, challenge }; } const { secret, challenge } = generateSecretData(); console.log('Secret:', secret); console.log('Challenge:', challenge); ``` --- ## Suporte Para dúvidas ou problemas, entre em contato pelo e-mail [produtos.certificadora@valid.com](mailto:produtos.certificadora@valid.com) ou acesse o [Portal Valid](https://valid-sa.atlassian.net/servicedesk/customer/portal/4/group/115/create/51).